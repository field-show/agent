(function(o,n){typeof exports=="object"&&typeof module!="undefined"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(o=typeof globalThis!="undefined"?globalThis:o||self,n(o.Agent={}))})(this,function(o){"use strict";let n=null;const i={},c={};function u(e){try{const t=JSON.parse(e.data),f=t["#"],d=t[":"];for(const s of i[f])s(d,f);for(const s of c[f])s(d,f);delete c[f]}catch{}}function l(e){n=new WebSocket(e),n.json=t=>n.send(JSON.stringify(t)),n.onmessage=u,n.onerror=n.onclose=()=>{n=null}}const a=()=>n;function r(e,t){n.json({_:"put","#":e,":":t})}function g(e,t){i[e]||(i[e]=new Set),i[e].add(t),n.json({_:"on","#":e})}const S=e=>new Promise(t=>{c[e]||(c[e]=new Set),c[e].add(t),n.json({_:"get","#":e})});o.client=a,o.connect=l,o.get=S,o.on=g,o.put=r,Object.defineProperty(o,"__esModule",{value:!0}),o[Symbol.toStringTag]="Module"});
